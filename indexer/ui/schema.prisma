generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://db_username:db_password@localhost:5434/db_name"
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l1_block_headers {
  hash               String               @id @db.VarChar
  parent_hash        String               @unique @db.VarChar
  number             Decimal              @unique @db.Decimal
  timestamp          Int                  @unique
  rlp_bytes          String               @db.VarChar
  l1_contract_events l1_contract_events[]

  @@index([number], map: "l1_block_headers_number")
  @@index([timestamp], map: "l1_block_headers_timestamp")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l1_bridge_deposits {
  transaction_source_hash   String                  @id @db.VarChar
  cross_domain_message_hash String                  @unique @db.VarChar
  from_address              String                  @db.VarChar
  to_address                String                  @db.VarChar
  local_token_address       String                  @db.VarChar
  remote_token_address      String                  @db.VarChar
  amount                    Decimal                 @db.Decimal
  data                      String                  @db.VarChar
  timestamp                 Int
  l1_bridge_messages        l1_bridge_messages      @relation(fields: [cross_domain_message_hash], references: [message_hash], onDelete: Cascade, onUpdate: NoAction)
  l1_transaction_deposits   l1_transaction_deposits @relation(fields: [transaction_source_hash], references: [source_hash], onDelete: Cascade, onUpdate: NoAction)

  @@index([cross_domain_message_hash], map: "l1_bridge_deposits_cross_domain_message_hash")
  @@index([from_address], map: "l1_bridge_deposits_from_address")
  @@index([timestamp], map: "l1_bridge_deposits_timestamp")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l1_bridge_messages {
  message_hash               String                  @id @db.VarChar
  nonce                      Decimal                 @unique @db.Decimal
  transaction_source_hash    String                  @unique @db.VarChar
  sent_message_event_guid    String                  @unique @db.VarChar
  relayed_message_event_guid String?                 @unique @db.VarChar
  from_address               String                  @db.VarChar
  to_address                 String                  @db.VarChar
  amount                     Decimal                 @db.Decimal
  gas_limit                  Decimal                 @db.Decimal
  data                       String                  @db.VarChar
  timestamp                  Int
  l1_bridge_deposits         l1_bridge_deposits?
  l2_contract_events         l2_contract_events?     @relation(fields: [relayed_message_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)
  l1_contract_events         l1_contract_events      @relation(fields: [sent_message_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)
  l1_transaction_deposits    l1_transaction_deposits @relation(fields: [transaction_source_hash], references: [source_hash], onDelete: Cascade, onUpdate: NoAction)

  @@index([from_address], map: "l1_bridge_messages_from_address")
  @@index([timestamp], map: "l1_bridge_messages_timestamp")
  @@index([transaction_source_hash], map: "l1_bridge_messages_transaction_source_hash")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l1_contract_events {
  guid                                                                                              String                      @id @db.VarChar
  block_hash                                                                                        String                      @db.VarChar
  contract_address                                                                                  String                      @db.VarChar
  transaction_hash                                                                                  String                      @db.VarChar
  log_index                                                                                         Int
  event_signature                                                                                   String                      @db.VarChar
  timestamp                                                                                         Int
  rlp_bytes                                                                                         String                      @db.VarChar
  l1_bridge_messages                                                                                l1_bridge_messages?
  l1_block_headers                                                                                  l1_block_headers            @relation(fields: [block_hash], references: [hash], onDelete: Cascade, onUpdate: NoAction)
  l1_transaction_deposits                                                                           l1_transaction_deposits?
  l2_bridge_messages                                                                                l2_bridge_messages?
  l2_transaction_withdrawals_l2_transaction_withdrawals_finalized_l1_event_guidTol1_contract_events l2_transaction_withdrawals? @relation("l2_transaction_withdrawals_finalized_l1_event_guidTol1_contract_events")
  l2_transaction_withdrawals_l2_transaction_withdrawals_proven_l1_event_guidTol1_contract_events    l2_transaction_withdrawals? @relation("l2_transaction_withdrawals_proven_l1_event_guidTol1_contract_events")

  @@unique([block_hash, log_index])
  @@index([block_hash], map: "l1_contract_events_block_hash")
  @@index([contract_address], map: "l1_contract_events_contract_address")
  @@index([event_signature], map: "l1_contract_events_event_signature")
  @@index([timestamp], map: "l1_contract_events_timestamp")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l1_transaction_deposits {
  source_hash             String              @id @db.VarChar
  l2_transaction_hash     String              @unique @db.VarChar
  initiated_l1_event_guid String              @unique @db.VarChar
  from_address            String              @db.VarChar
  to_address              String              @db.VarChar
  amount                  Decimal             @db.Decimal
  gas_limit               Decimal             @db.Decimal
  data                    String              @db.VarChar
  timestamp               Int
  l1_bridge_deposits      l1_bridge_deposits?
  l1_bridge_messages      l1_bridge_messages?
  l1_contract_events      l1_contract_events  @relation(fields: [initiated_l1_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)

  @@index([from_address], map: "l1_transaction_deposits_from_address")
  @@index([initiated_l1_event_guid], map: "l1_transaction_deposits_initiated_l1_event_guid")
  @@index([timestamp], map: "l1_transaction_deposits_timestamp")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l2_block_headers {
  hash               String               @id @db.VarChar
  parent_hash        String               @unique @db.VarChar
  number             Decimal              @unique @db.Decimal
  timestamp          Int
  rlp_bytes          String               @db.VarChar
  l2_contract_events l2_contract_events[]

  @@index([number], map: "l2_block_headers_number")
  @@index([timestamp], map: "l2_block_headers_timestamp")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l2_bridge_messages {
  message_hash                String                     @id @db.VarChar
  nonce                       Decimal                    @unique @db.Decimal
  transaction_withdrawal_hash String                     @unique @db.VarChar
  sent_message_event_guid     String                     @unique @db.VarChar
  relayed_message_event_guid  String?                    @unique @db.VarChar
  from_address                String                     @db.VarChar
  to_address                  String                     @db.VarChar
  amount                      Decimal                    @db.Decimal
  gas_limit                   Decimal                    @db.Decimal
  data                        String                     @db.VarChar
  timestamp                   Int
  l1_contract_events          l1_contract_events?        @relation(fields: [relayed_message_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)
  l2_contract_events          l2_contract_events         @relation(fields: [sent_message_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)
  l2_transaction_withdrawals  l2_transaction_withdrawals @relation(fields: [transaction_withdrawal_hash], references: [withdrawal_hash], onDelete: Cascade, onUpdate: NoAction)
  l2_bridge_withdrawals       l2_bridge_withdrawals?

  @@index([from_address], map: "l2_bridge_messages_from_address")
  @@index([timestamp], map: "l2_bridge_messages_timestamp")
  @@index([transaction_withdrawal_hash], map: "l2_bridge_messages_transaction_withdrawal_hash")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l2_bridge_withdrawals {
  transaction_withdrawal_hash String                     @id @db.VarChar
  cross_domain_message_hash   String                     @unique @db.VarChar
  from_address                String                     @db.VarChar
  to_address                  String                     @db.VarChar
  local_token_address         String                     @db.VarChar
  remote_token_address        String                     @db.VarChar
  amount                      Decimal                    @db.Decimal
  data                        String                     @db.VarChar
  timestamp                   Int
  l2_bridge_messages          l2_bridge_messages         @relation(fields: [cross_domain_message_hash], references: [message_hash], onDelete: Cascade, onUpdate: NoAction)
  l2_transaction_withdrawals  l2_transaction_withdrawals @relation(fields: [transaction_withdrawal_hash], references: [withdrawal_hash], onDelete: Cascade, onUpdate: NoAction)

  @@index([cross_domain_message_hash], map: "l2_bridge_withdrawals_cross_domain_message_hash")
  @@index([from_address], map: "l2_bridge_withdrawals_from_address")
  @@index([timestamp], map: "l2_bridge_withdrawals_timestamp")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l2_contract_events {
  guid                       String                      @id @db.VarChar
  block_hash                 String                      @db.VarChar
  contract_address           String                      @db.VarChar
  transaction_hash           String                      @db.VarChar
  log_index                  Int
  event_signature            String                      @db.VarChar
  timestamp                  Int
  rlp_bytes                  String                      @db.VarChar
  l1_bridge_messages         l1_bridge_messages?
  l2_bridge_messages         l2_bridge_messages?
  l2_block_headers           l2_block_headers            @relation(fields: [block_hash], references: [hash], onDelete: Cascade, onUpdate: NoAction)
  l2_transaction_withdrawals l2_transaction_withdrawals?

  @@unique([block_hash, log_index])
  @@index([block_hash], map: "l2_contract_events_block_hash")
  @@index([contract_address], map: "l2_contract_events_contract_address")
  @@index([event_signature], map: "l2_contract_events_event_signature")
  @@index([timestamp], map: "l2_contract_events_timestamp")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model l2_transaction_withdrawals {
  withdrawal_hash                                                                           String                 @id @db.VarChar
  nonce                                                                                     Decimal                @unique @db.Decimal
  initiated_l2_event_guid                                                                   String                 @unique @db.VarChar
  proven_l1_event_guid                                                                      String?                @unique @db.VarChar
  finalized_l1_event_guid                                                                   String?                @unique @db.VarChar
  succeeded                                                                                 Boolean?
  from_address                                                                              String                 @db.VarChar
  to_address                                                                                String                 @db.VarChar
  amount                                                                                    Decimal                @db.Decimal
  gas_limit                                                                                 Decimal                @db.Decimal
  data                                                                                      String                 @db.VarChar
  timestamp                                                                                 Int
  l2_bridge_messages                                                                        l2_bridge_messages?
  l2_bridge_withdrawals                                                                     l2_bridge_withdrawals?
  l1_contract_events_l2_transaction_withdrawals_finalized_l1_event_guidTol1_contract_events l1_contract_events?    @relation("l2_transaction_withdrawals_finalized_l1_event_guidTol1_contract_events", fields: [finalized_l1_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)
  l2_contract_events                                                                        l2_contract_events     @relation(fields: [initiated_l2_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)
  l1_contract_events_l2_transaction_withdrawals_proven_l1_event_guidTol1_contract_events    l1_contract_events?    @relation("l2_transaction_withdrawals_proven_l1_event_guidTol1_contract_events", fields: [proven_l1_event_guid], references: [guid], onDelete: Cascade, onUpdate: NoAction)

  @@index([from_address], map: "l2_transaction_withdrawals_from_address")
  @@index([initiated_l2_event_guid], map: "l2_transaction_withdrawals_initiated_l2_event_guid")
  @@index([timestamp], map: "l2_transaction_withdrawals_timestamp")
}
